- name: Restart Next.js app
  uses: appleboy/ssh-action@v1.0.3
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ${{ secrets.EC2_USER }}
    key: ${{ secrets.EC2_SSH_KEY }}
    port: ${{ secrets.EC2_SSH_PORT }}
    script: |
      cd /home/${{ secrets.EC2_USER }}/dashboard
      # Install dependencies on EC2
      npm ci
      # Build on EC2 (better than building locally)
      npm run build
      # Restart PM2 app correctly
      pm2 restart cupid-ai-dashboard || pm2 start npm --name "cupid-ai-dashboard" -- run start
      pm2 save
